import{computeDomain}from"./common/entity/compute_domain";import{formatDuration,UNIT_TO_MILLISECOND_CONVERT}from"./datetime/duration";import{formatDate}from"./datetime/format_date";import{formatDateTime}from"./datetime/format_date_time";import{formatTime}from"./datetime/format_time";import{formatNumber,getNumberFormatOptions,isNumericFromAttributes}from"./format_number";let UNAVAILABLE="unavailable",UNKNOWN="unknown",computeStateDisplaySingleEntity=(t,e,r,i,a)=>computeStateDisplayFromEntityAttributes(t,r,i,e.entity_id,e.attributes,void 0!==a?a:e.state),computeStateDisplay=(t,e,r,i,a)=>{i=i[e.entity_id];return computeStateDisplayFromEntityAttributes(t,r,i,e.entity_id,e.attributes,void 0!==a?a:e.state)},computeStateDisplayFromEntityAttributes=(t,e,r,i,a,m)=>{if(m===UNKNOWN||m===UNAVAILABLE)return t("state.default."+m);if(isNumericFromAttributes(a)){if("duration"===a.device_class&&a.unit_of_measurement&&UNIT_TO_MILLISECOND_CONVERT[a.unit_of_measurement])try{return formatDuration(m,a.unit_of_measurement)}catch(t){}if("monetary"===a.device_class)try{return formatNumber(m,e,{style:"currency",currency:a.unit_of_measurement,minimumFractionDigits:2,...getNumberFormatOptions({state:m,attributes:a},r)})}catch(t){}var n=a.unit_of_measurement?" "+a.unit_of_measurement:"";return formatNumber(m,e,getNumberFormatOptions({state:m,attributes:a},r))+n}n=computeDomain(i);if(["date","input_datetime","time"].includes(n)){if(void 0===m){let t;return a.has_date&&a.has_time?(t=new Date(a.year,a.month-1,a.day,a.hour,a.minute),formatDateTime(t,e)):a.has_date?(t=new Date(a.year,a.month-1,a.day),formatDate(t,e)):a.has_time?((t=new Date).setHours(a.hour,a.minute),formatTime(t,e)):m}try{var o,u=m.split(" ");if(2===u.length)return formatDateTime(new Date(u.join("T")),e);if(1===u.length){if(m.includes("-"))return formatDate(new Date(m+"T00:00"),e);if(m.includes(":"))return o=new Date,formatTime(new Date(o.toISOString().split("T")[0]+"T"+m),e)}return m}catch(t){return m}}if("humidifier"===n&&"on"===m&&a.humidity)return a.humidity+" %";if("counter"===n||"number"===n||"input_number"===n)return formatNumber(m,e,getNumberFormatOptions({state:m,attributes:a},r));if(["button","input_button","scene","stt","tts"].includes(n)||"sensor"===n&&"timestamp"===a.device_class)try{return formatDateTime(new Date(m),e)}catch(t){return m}return r?.translation_key&&t(`component.${r.platform}.entity.${n}.${r.translation_key}.state.`+m)||a.device_class&&t(`component.${n}.entity_component.${a.device_class}.state.`+m)||t(`component.${n}.entity_component._.state.`+m)||m};export{computeStateDisplaySingleEntity,computeStateDisplay,computeStateDisplayFromEntityAttributes};